.. index:: upgrading; from 3.0.x

Upgrading from 3.0.x to 3.1.x
=============================

#. Upgrade packages. Run the following commands:

   .. code-block:: bash

        apt-get update
        apt-get install karaage3

   If asked if you want to run to run migrations, so No. This will happen
   later.

#. Merge in changes from ``/etc/karaage/global_settings.py`` into
   ``/etc/karaage3/settings.py``. Or just copy the file should be sufficient.

#. If required, install Karaage plugins. For example, for karaage-usage, run
   the following command:

   .. code-block:: bash

       apt-get install python-kgusage

   Add the :setting:`PLUGINS` to ``/etc/karaage3/settings.py``:

   .. code-block:: python

        PLUGINS = [
            'kgusage.plugin',
        ]

   Restart karaage3-celery:

   .. code-block:: bash

       service karaage3-celery restart

#. Otherwise purge karaage3-celery if kgusage not required.

#. Any old Apache configuration might conflict with the new Apache
   configuration.  Apache 2.2 in Wheezy uses
   ``/etc/apache2/conf.d/karaage-wsgi.conf``. Any other configuration files may
   be obsolete and should be deleted (or moved elsewehere).

#. Run the database migrations, restart apache, and install the celery
   deaemon.

   .. code-block:: bash

        kg-manage migrate --all
        service apache2 reload

#.  Remove old package that might cause problems.

    .. code-block:: bash

        dpkg --purge python-karaage-celery

#.  Old packages and files can be removed. This is optional.

    .. code-block:: bash

        dpkg --purge karaage3-admin
        dpkg --purge karaage3-registration
        dpkg --purge python-karaage-doc
        rm -rf /etc/karaage
        rm -rf /var/log/karaage
        rm -rf /var/cache/karaage


Other changes:
--------------

*   Check that remote services that access Karaage work. For example, with
    torque_submitfilter, you need to update the Karaage URL to ``/karaage/``.
