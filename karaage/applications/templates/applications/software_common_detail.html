{% extends "main.html" %}
{% load url from future %}
{% load applications %}


{% block title %}Application{% endblock %}


{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href='{{ base_url|default:"/" }}'>Home</a>&nbsp;›
    <a href="{% url 'kg_application_list' %}">Applications</a>&nbsp;›
    {{ application }}
</div>
{% endblock %}


{% block object-tools %}
{% if auth.is_admin %}
<div class="module object-tools">
<h2>Tasks</h2>
<ul>
    <li><a href="{% url 'kg_application_logs' application.pk %}">Logs</a></li>
    <li class="addlink"><a href="{% url 'kg_application_add_comment' application.pk %}">Add comment</a></li>
</ul>
</div>
{% endif %}
{% endblock %}


{% block content %}
<div id="content-main">
    <h1>{{ application.applicant }}'s Request</h1>
    <p>{{ application.applicant }} has requested <b>{{ application.info }}</b></p>

    <div class="module">
        <h2>Current Status</h2>

        <p>Application process:</p>
        {% application_state "software" application %}

        {% if application.state == 'L' and auth.is_leader %}
        <p>As you are a project leader, please
        <a class="yeslink" href="{% url 'kg_application_detail' application.id application.state 'approve' %}">Approve</a> or
        <a class="nolink" href="{% url 'kg_application_detail' application.id application.state 'decline' %}">Decline</a> this request</p>
        {% elif application.state == 'D' and auth.is_delegate %}
        <p>As you are an institute delegate, please
        <a class="yeslink" href="{% url 'kg_application_detail' application.id application.state 'approve' %}">Approve</a> or
        <a class="nolink" href="{% url 'kg_application_detail' application.id application.state 'decline' %}">Decline</a> this request</p>
        {% elif application.state == 'K' and auth.is_admin %}
        <p>As you are an administrator, please
        <a class="yeslink" href="{% url 'kg_application_detail' application.id application.state 'approve' %}">Approve</a> or
        <a class="nolink" href="{% url 'kg_application_detail' application.id application.state 'decline' %}">Decline</a> this request</p>
        {% endif %}
    </div>

    <div class="module">
        <h2>Application Details</h2>
        <table>
            {% if auth.is_admin %}
            <tr><td>Secret Token:</td><td>{{ application.secret_token }}</td></tr>
            {% endif %}
            <tr><td>Expires:</td><td>{{ application.expires }}</td></tr>
            <tr><td>Created by:</td><td>{{ application.created_by }}</td></tr>
            <tr><td>Created date:</td><td>{{ application.created_date }}</td></tr>
            <tr><td>Submitted date:</td><td>{{ application.submitted_date }}</td></tr>
            <tr><td>Complete date:</td><td>{{ application.complete_date }}</td></tr>
        </table>
    </div>

    <div class="module">
        <h2>Applicant Details</h2>
        <table>
            {% if application.content_type.model == 'applicant' %}
            <tr><td>Applicant type</td><td>New applicant {% if auth.is_admin %}<a href="{% url 'kg_applicant_edit' application.applicant.pk %}">[edit]</a>{% endif %}</td>
            <tr><td>Username:</td><td>{{ application.applicant.username }}</td></tr>
            {% elif application.content_type.model == 'person' %}
            <tr><td>Applicant type</td><td>Existing person</td>
            <tr><td>Username:</td><td><a href="{% url 'kg_person_detail' application.applicant.username %}">{{ application.applicant.username }}</a></td></tr>
            {% else %}
            <tr><td>Applicant type</td><td>Unknown {{ application.content_type.model }}</td>
            <tr><td>Username:</td><td>{{ application.applicant.username }}</td></tr>
            {% endif %}

            <tr><td>Short name:</td><td>{{ application.applicant.get_short_name }}</td></tr>
            <tr><td>Full name:</td><td>{{ application.applicant.get_full_name }}</td></tr>
            <tr><td>Email:</td><td>{{ application.applicant.email|urlize }}</td></tr>
            <tr><td>Institute:</td><td>{% if application.applicant.institute %}<a href="{{ application.applicant.institute.get_absolute_url }}">{{ application.applicant.institute }}</a>{% else %}None{% endif %}</td></tr>
            {% if application.applicant.position %}<tr><td>Position:</td><td>{{ application.applicant.position }}</td></tr>{% endif %}
            {% if application.applicant.telephone %}<tr><td>Phone:</td><td>{{ application.applicant.telephone }}</td></tr>{% endif %}
            {% if application.applicant.mobile %}<tr><td>Mobile:</td><td>{{ application.applicant.mobile }}</td></tr>{% endif %}
            {% if application.applicant.department %}<tr><td>Department:</td><td>{{ application.applicant.department }}</td></tr>{% endif %}
            {% if application.applicant.supervisor %}<tr><td>Supervisor:</td><td>{{ application.applicant.supervisor }}</td></tr>{% endif %}
            {% if application.applicant.fax %}<tr><td>Fax:</td><td>{{ application.applicant.fax }}</td></tr>{% endif %}
        </table>
    </div>

    <div class="module">
        <h2>Software License Details</h2>
        <table>
            {% if auth.is_admin %}
            <tr>
                <td>Software:</td>
                <td><a href="{% url 'kg_software_detail' application.software_license.software.pk %}">{{ application.software_license.software }}</a></td>
            </tr>
            {% else %}
            <tr><td>Software:</td><td>{{ application.software_license.software }}</td></tr>
            {% endif %}
            <tr><td>Version:</td><td>{{ application.software_license.version }}</td></tr>
            <tr><td>Text:</td><td>{{ application.software_license.text|linebreaks }}</td></tr>
        </table>
    </div>

    {% if auth.is_admin %}
    {% comments application.application_ptr %}
    {% endif %}

    <form method="post" action=".">{% csrf_token %}
        {% application_actions %}
    </form>
</div>
{% endblock %}


